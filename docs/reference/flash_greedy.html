<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Greedily add factors to a flash object — flash_greedy • flashier</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Greedily add factors to a flash object — flash_greedy"><meta property="og:description" content='Adds factor/loadings pairs to a flash object in a "greedy" manner. Up to
Kmax pairs are added one at a time. At each step, flash_greedy
attempts to find an optimal additional (rank-one) factor given all
previously added factors. The additional factor is retained if it
increases the variational lower bound (ELBO); otherwise, fitting terminates.
See flash for examples of usage.'><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">flashier</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.53</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/willwerscheid/flashier" class="external-link">Source</a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Greedily add factors to a flash object</h1>
    <small class="dont-index">Source: <a href="https://github.com/willwerscheid/flashier/blob/HEAD/R/flash_greedy.R" class="external-link"><code>R/flash_greedy.R</code></a></small>
    <div class="hidden name"><code>flash_greedy.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Adds factor/loadings pairs to a flash object in a "greedy" manner. Up to
<code>Kmax</code> pairs are added one at a time. At each step, <code>flash_greedy</code>
attempts to find an optimal additional (rank-one) factor given all
previously added factors. The additional factor is retained if it
increases the variational lower bound (ELBO); otherwise, fitting terminates.
See <code><a href="flash.html">flash</a></code> for examples of usage.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">flash_greedy</span><span class="op">(</span></span>
<span>  <span class="va">flash</span>,</span>
<span>  Kmax <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  ebnm_fn <span class="op">=</span> <span class="va">ebnm_point_normal</span>,</span>
<span>  init_fn <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  extrapolate <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  warmstart <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  maxiter <span class="op">=</span> <span class="fl">500</span>,</span>
<span>  tol <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>flash</dt>
<dd><p>A <code>flash</code> or <code>flash_fit</code> object to which factors are
to be added.</p></dd>


<dt>Kmax</dt>
<dd><p>The maximum number of factors to be added. This will not
necessarily be the total number of factors added by
<code>flash_greedy</code>, since factors are only added as long as they
increase the ELBO.</p></dd>


<dt>ebnm_fn</dt>
<dd><p>The function or functions used to solve the empirical Bayes
normal means (EBNM) subproblems. Most importantly, these functions specify
the families of distributions \(G_\ell^{(k)}\) and \(G_f^{(k)}\) to which the
priors on loadings and factors \(g_\ell^{(k)}\) and \(g_f^{(k)}\) are
assumed to belong. If the same function is to be used for both loadings
\(L\) and factors \(F\), then <code>ebnm_fn</code> can be a single function.
If one function is to be used for loadings and a second for factors,
then <code>ebnm_fn</code> should be a list of length two, with the first
element giving the function for loadings and the second the function
for factors. If different functions are to be used for different values of
\(k\), then factor/loadings pairs must be added successively using
multiple calls to either <code>flash_greedy</code> or
<code><a href="flash_factors_init.html">flash_factors_init</a></code>.</p>
<p>Any EBNM function provided by package <code><a href="https://rdrr.io/pkg/ebnm/man/ebnm.html" class="external-link">ebnm</a></code> can be
used as input. Non-default arguments to parameters can be supplied using
the helper function <code><a href="flash_ebnm.html">flash_ebnm</a></code>. Custom EBNM functions can
also be used: for details, see <code><a href="flash_ebnm.html">flash_ebnm</a></code>.</p></dd>


<dt>init_fn</dt>
<dd><p>The function used to initialize factor/loadings pairs. Functions
<code><a href="flash_greedy_init_default.html">flash_greedy_init_default</a></code>, <code><a href="flash_greedy_init_softImpute.html">flash_greedy_init_softImpute</a></code>, and
<code><a href="flash_greedy_init_irlba.html">flash_greedy_init_irlba</a></code> have been supplied; note, in particular, that
<code><a href="flash_greedy_init_softImpute.html">flash_greedy_init_softImpute</a></code> can yield better results than the
default initialization function when there is missing data. Custom
initialization functions may also be used. If <code>init_fn = NULL</code> then
<code><a href="flash_greedy_init_default.html">flash_greedy_init_default</a></code> will be used, with an attempt made to set
argument <code>sign_constraints</code> appropriately via test calls to
the EBNM function(s) specified by parameter <code>ebnm_fn</code>. If factors or loadings
are constrained in some other fashion (e.g., bounded support), then the
initialization function should be modified to account for the constraints
--- otherwise, the greedy algorithm can stop adding factor/loadings pairs
too early. Custom initialization functions should accept a single
parameter referring to a <code><a href="flash_fit.html">flash_fit</a></code> object and should output
a list consisting of two vectors, which will be used as initial values for
the new loadings \(\ell_{\cdot k}\) and the new factor \(f_{\cdot k}\). Typically,
a custom initialization function will extract the matrix of residuals from
the <code>flash_fit</code> object using method <code>residuals.flash_fit</code> and
then return a (possibly constrained) rank-one approximation to the matrix
of residuals. See <strong>Examples</strong> below.</p></dd>


<dt>extrapolate</dt>
<dd><p>Whether to use an extrapolation technique
inspired by Ang and Gillis (2019) to accelerate the fitting process.
Control parameters are handled via global options and can be set by
calling <code>options("extrapolate.control") &lt;- control.param</code>.</p></dd>


<dt>warmstart</dt>
<dd><p>Whether to use "warmstarts" when solving the EBNM
subproblems by initializing solutions at the previous value of the fitted
prior \(\hat{g}\). An important side effect of warmstarts for
<code>ashr</code>-like prior families is to fix the grid at its initial setting.
Fixing the grid can lead to poor fits if there
are large changes in the scale of the estimated prior over the
course of the fitting process. However, allowing the grid to
vary can occasionally result in decreases in ELBO.</p></dd>


<dt>maxiter</dt>
<dd><p>The maximum number of iterations when optimizing a greedily
added factor/loadings pair.</p></dd>


<dt>tol</dt>
<dd><p>The convergence tolerance parameter. At each iteration, the fit
is compared to the fit from the previous iteration using a convergence
criterion function (by default, the difference in ELBO, but the criterion
can be changed via <code><a href="flash_set_conv_crit.html">flash_set_conv_crit</a></code>). When
the value returned by this function is less than or equal to <code>tol</code>,
the newly added factor/loadings pair is considered to have "converged,"
so that <code>flash_greedy</code> moves on and attempts to add another new
factor (or, if the maximum number of factors <code>Kmax</code> has been reached,
the process terminates). Note that
specifying <code>tol</code> here will override any value set by
<code>flash_set_conv_crit</code>; to use the "global" tolerance parameter,
<code>tol</code> must be left unspecified (<code>NULL</code>).
If <code>tol = NULL</code> and a global tolerance
parameter has not been set, then the default
tolerance used is \(np\sqrt{\epsilon}\), where \(n\) is the
number of rows in the dataset, \(p\) is the number of columns, and
\(\epsilon\) is equal to <code><a href="https://rdrr.io/r/base/zMachine.html" class="external-link">.Machine</a>$double.eps</code>.</p></dd>


<dt>verbose</dt>
<dd><p>When and how to display progress updates. Set to
<code>0</code> for none, <code>1</code> for updates after a factor is added or a
backfit is completed, <code>2</code> for additional notifications about the
variational lower bound, and <code>3</code> for updates after every iteration.
It is also possible to output a single tab-delimited table of values
using function <code><a href="flash_set_verbose.html">flash_set_verbose</a></code> with <code>verbose = -1</code>.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>The <code><a href="flash.html">flash</a></code> object from argument <code>flash</code>, with up
to <code>Kmax</code> new factor/loadings pairs "greedily" added.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="flash_greedy_init_default.html">flash_greedy_init_default</a></code>,
<code><a href="flash_greedy_init_softImpute.html">flash_greedy_init_softImpute</a></code>,
<code><a href="flash_greedy_init_irlba.html">flash_greedy_init_irlba</a></code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># The following are examples of advanced usage. See ?flash for basic usage.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Increase the maximum number of iterations in the default initialization</span></span></span>
<span class="r-in"><span><span class="co">#   method.</span></span></span>
<span class="r-in"><span><span class="va">my_init_fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">f</span><span class="op">)</span> <span class="fu"><a href="flash_greedy_init_default.html">flash_greedy_init_default</a></span><span class="op">(</span><span class="va">f</span>, maxiter <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fl</span> <span class="op">&lt;-</span> <span class="fu"><a href="flash_init.html">flash_init</a></span><span class="op">(</span><span class="va">gtex</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">flash_greedy</span><span class="op">(</span>init_fn <span class="op">=</span> <span class="va">my_init_fn</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Adding factor 1 to flash object...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Wrapping up...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Done.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Use a custom initialization function that wraps function nmf from</span></span></span>
<span class="r-in"><span><span class="co">#   package RcppML.</span></span></span>
<span class="r-in"><span><span class="va">nmf_init_fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">f</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">nmf_res</span> <span class="op">&lt;-</span> <span class="fu">RcppML</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RcppML/man/nmf.html" class="external-link">nmf</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">resid</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span>, k <span class="op">=</span> <span class="fl">1</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">nmf_res</span><span class="op">$</span><span class="va">w</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">nmf_res</span><span class="op">$</span><span class="va">h</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">fl.nmf</span> <span class="op">&lt;-</span> <span class="fu"><a href="flash_init.html">flash_init</a></span><span class="op">(</span><span class="va">gtex</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">flash_greedy</span><span class="op">(</span>ebnm_fn <span class="op">=</span> <span class="va">ebnm_unimodal_nonnegative</span>,</span></span>
<span class="r-in"><span>               init_fn <span class="op">=</span> <span class="va">nmf_init_fn</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Adding factor 1 to flash object...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Wrapping up...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Done.</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Jason Willwerscheid, Peter Carbonetto, Wei Wang, Matthew Stephens.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

